---
title: "Server SDK"
description: "Node.js API for exchanging codes, refreshing tokens, and proxying Mio Context lookups."
---

## Initialization

```typescript src/lib/mio/server.ts
import { Mio } from '@mio-xyz/sdk/server';

export const mio = Mio.init({
  clientId: process.env.MIO_CLIENT_ID!,
  redirectUrl: process.env.MIO_REDIRECT_URL!,
  clientSecret: process.env.MIO_CLIENT_SECRET!
});
```

<Info>
  `Mio.init` is idempotent on the server. Call it during module evaluation or process startup and reuse `Mio.getInstance()` everywhere else.
</Info>

### Config parameters

<ParamField body="clientId" type="string" required>
OAuth application ID from the Mio dashboard.
</ParamField>
<ParamField body="redirectUrl" type="string" required>
Absolute URL where Mio sends users back after the connection flow. Must match the redirect configured in Mio.
</ParamField>
<ParamField body="clientSecret" type="string" required>
Confidential secret used only on the server when exchanging or refreshing tokens.
</ParamField>
## Methods

### `exchangeCodeForTokens(code: string): Promise<MioOauth2TokenResponse>`

Swaps an authorization code for tokens using the confidential client credentials.

<ParamField body="code" type="string" required>
Authorization code provided by the Mio auth workflow.
</ParamField>

<ResponseField name="response" type="MioOauth2TokenResponse" required>
  [`MioOauth2TokenResponse`](/api-reference/types#token-response-schema) containing `accessToken`, `refreshToken`, `expiresIn`, `tokenType`, and `idToken`.
</ResponseField>


<RequestExample>
```typescript
const tokens = await mio.exchangeCodeForTokens(code);
await userStore.save({
  accessToken: tokens.accessToken,
  refreshToken: tokens.refreshToken,
  expiresAt: Date.now() + tokens.expiresIn * 1000
});
```
</RequestExample>

<ResponseExample>
```json Success
{
  "accessToken": "atk_123",
  "refreshToken": "rtk_123",
  "idToken": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresIn": 3600,
  "tokenType": "Bearer"
}
```
</ResponseExample>

<Warning>
  Errors include the underlying OAuth message. Log them before rethrowing so you can differentiate `invalid_grant` from network issues.
</Warning>

### `refreshTokens(refreshToken: string): Promise<MioOauth2TokenResponse>`

Mint a new access token (and refresh token) without user interaction.

<ParamField body="refreshToken" type="string" required>
The token you persisted from the previous exchange.
</ParamField>

<ResponseField name="response" type="MioOauth2TokenResponse" required>
  [`MioOauth2TokenResponse`](/api-reference/types#token-response-schema) containing `accessToken`, `refreshToken`, `expiresIn`, `tokenType`, and `idToken`.
</ResponseField>

<Tip>
  Access tokens expire after 24 hours. Schedule `refreshTokens(refreshToken)` before they expire (cron job, background worker, or on-demand when you receive a 401) and store the newly returned tokens.
</Tip>

### `getContext({ query, accessToken }): Promise<string>`

Server-side wrapper that shares the same implementation as the client version. Use it when you run long operations or batch context requests on the backend.

#### Returns

<ResponseField name="response" type="string" required>
The refined and personalized user summary, based on your query
</ResponseField>

### `getContextSummary({ accessToken }): Promise<string | null>`

Retrieves the latest Mio Context summary for the given user.

<ResponseField name="response" type="string | null" required>
Return the user summary if Mio has one, else return null.
</ResponseField>

## Error matrix

| Method | Error | Description |
| --- | --- | --- |
| `exchangeCodeForTokens` | `invalid_grant` | Redirect URL or client credentials mismatch |
| `exchangeCodeForTokens` | `invalid_request` | Missing `code` body parameter |
| `refreshTokens` | `invalid_grant` | Expired or revoked refresh token |
| `getContext`/`getContextSummary` | `401 Unauthorized` | Access token expired or malformed |

<Note>
  All methods throw standard `Error` objects. Wrap calls with try/catch and map them to HTTP status codes that make sense for your API surface.
</Note>
